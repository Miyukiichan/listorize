@page "/list/{id:int}"
@using listorize.Components.Util
@using Microsoft.EntityFrameworkCore
@using Model
@inject NavigationManager navManager
@inject IDialogService dialogs
@inject ListorizeContext db

<Grid T="Model.ListItem" NavigationURI="list" OnOpen="OnOpen" GetData="GetData" BeforeAdd="BeforeAdd">
    <PropertyColumn T="Model.ListItem" TProperty="string" Property="x => x.Name" Editable="false" Required="false"></PropertyColumn>
</Grid>

@code {
    [Parameter] public int Id { get; set; }

    async Task OnOpen(ListItem item) {
        if (item.ListId is not null) {
            navManager.NavigateTo($"/list/{item.ListId}");
        }
        else if (item.NoteId is not null) {
            navManager.NavigateTo($"/note/{item.NoteId}");
        }
        else {
            await dialogs.ShowMessageBox("Error", "Nothing to open");
        }
    }
    async Task<List<ListItem>> GetData() {
        return db.ListItem
            .Include(x => x.List)
            .Include(x => x.Note)
            .Where(x => x.ParentListId == Id)
            .ToList();
    }
    async Task BeforeAdd(ListItem item) {
        item.ParentListId = Id;
    }
}
